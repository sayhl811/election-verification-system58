<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–æ–≤</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
}
.container {
    max-width: 1200px;
    width: 100%;
    background: white;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    overflow: hidden;
    animation: fadeIn 0.5s ease-out;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.header {
    background: linear-gradient(to right, #2c3e50, #4a6491);
    color: white;
    padding: 25px;
    text-align: center;
    position: relative;
    overflow: hidden;
}
.header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 30px 30px;
    animation: movePattern 20s linear infinite;
}
@keyframes movePattern {
    0% { transform: translate(0, 0); }
    100% { transform: translate(30px, 30px); }
}
.header h1 {
    font-size: 28px;
    margin-bottom: 10px;
    font-weight: 600;
    position: relative;
    z-index: 1;
}
.header p {
    font-size: 16px;
    opacity: 0.9;
    position: relative;
    z-index: 1;
}
.user-panel {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255,255,255,0.1);
    padding: 8px 15px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
}
.user-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #3498db;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}
.main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    padding: 30px;
}
@media (max-width: 992px) {
    .main-content {
        grid-template-columns: 1fr;
        padding: 20px;
    }
}
.panel {
    background: #ffffff;
    border-radius: 15px;
    padding: 25px;
    border: 1px solid #e9ecef;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.panel:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}
.panel h2 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 20px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}
.video-container {
    width: 100%;
    height: 320px;
    background: linear-gradient(45deg, #1a237e, #283593);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 20px;
    position: relative;
}
.video-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
    padding: 20px;
}
.video-icon {
    font-size: 60px;
    margin-bottom: 15px;
    animation: pulse 2s infinite;
}
@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.9; }
}
.video-feed {
    display: none;
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.controls {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    min-width: 140px;
    justify-content: center;
}
.btn-primary {
    background: linear-gradient(to right, #3498db, #2980b9);
    color: white;
}
.btn-success {
    background: linear-gradient(to right, #27ae60, #219653);
    color: white;
}
.btn-danger {
    background: linear-gradient(to right, #e74c3c, #c0392b);
    color: white;
}
.btn-warning {
    background: linear-gradient(to right, #f39c12, #e67e22);
    color: white;
}
.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    opacity: 0.95;
}
.btn:active {
    transform: translateY(0);
}
.status-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}
.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #95a5a6;
    animation: none;
}
.status-dot.active {
    background: #27ae60;
    animation: pulse 1.5s infinite;
}
.alert {
    padding: 18px;
    margin: 15px 0;
    border-radius: 10px;
    font-weight: 600;
    border-left: 5px solid;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: slideIn 0.3s ease-out;
}
@keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}
.alert-warning {
    background: linear-gradient(to right, #fff9e6, #fff3cd);
    border-color: #ffc107;
    color: #856404;
}
.alert-info {
    background: linear-gradient(to right, #e8f4f8, #d1ecf1);
    border-color: #17a2b8;
    color: #0c5460;
}
.alert-success {
    background: linear-gradient(to right, #e8f8ef, #d4edda);
    border-color: #28a745;
    color: #155724;
}
.violation-list {
    max-height: 350px;
    overflow-y: auto;
    padding-right: 10px;
}
.violation-list::-webkit-scrollbar {
    width: 6px;
}
.violation-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}
.violation-list::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}
.violation-list::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
.violation-item {
    background: white;
    padding: 18px;
    margin-bottom: 12px;
    border-radius: 10px;
    border-left: 5px solid;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    transition: transform 0.2s ease;
    cursor: pointer;
}
.violation-item:hover {
    transform: translateX(5px);
}
.violation-item.high-priority {
    border-left-color: #e74c3c;
    background: linear-gradient(to right, #fff5f5, #ffeaea);
}
.violation-item.medium-priority {
    border-left-color: #f39c12;
    background: linear-gradient(to right, #fff9e6, #fff3cd);
}
.violation-item.low-priority {
    border-left-color: #3498db;
    background: linear-gradient(to right, #f0f8ff, #e3f2fd);
}
.procedure-list {
    display: grid;
    gap: 12px;
}
.procedure-item {
    background: white;
    padding: 18px;
    border-radius: 10px;
    border-left: 5px solid #3498db;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    gap: 12px;
}
.procedure-item:hover {
    background: linear-gradient(to right, #e3f2fd, #f0f8ff);
    transform: translateX(8px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.voice-control {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 1px solid #e9ecef;
}
.voice-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 24px;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
}
.voice-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
}
.voice-btn.listening {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    animation: pulse 0.8s infinite;
}
.report-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px dashed #e9ecef;
}
textarea {
    width: 100%;
    min-height: 120px;
    padding: 15px;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    resize: vertical;
    font-size: 14px;
    transition: border-color 0.3s ease;
}
textarea:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}
.login-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}
.login-form {
    background: white;
    padding: 40px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}
.login-form h3 {
    text-align: center;
    margin-bottom: 30px;
    color: #2c3e50;
}
.form-group {
    margin-bottom: 20px;
}
.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #2c3e50;
    font-weight: 600;
}
.form-group input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}
.form-group input:focus {
    outline: none;
    border-color: #3498db;
}
.statistics {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin: 20px 0;
}
.stat-item {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
}
.stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 5px;
}
.stat-label {
    font-size: 12px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.footer {
    background: #f8f9fa;
    padding: 20px;
    text-align: center;
    color: #6c757d;
    font-size: 14px;
    border-top: 1px solid #e9ecef;
}
.nav-menu {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
    padding: 0 30px;
}
.nav-btn {
    padding: 10px 20px;
    background: #f8f9fa;
    border: 1px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
}
.nav-btn:hover {
    background: #e9ecef;
}
.nav-btn.active {
    background: #3498db;
    color: white;
    border-color: #2980b9;
}
.settings-panel {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    z-index: 2000;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}
.settings-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 1999;
}
.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}
.settings-header h3 {
    color: #2c3e50;
    font-size: 20px;
    margin: 0;
}
.settings-group {
    margin-bottom: 25px;
}
.settings-group h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 16px;
}
.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #e9ecef;
}
.setting-item:last-child {
    border-bottom: none;
}
.setting-label {
    font-size: 14px;
    color: #2c3e50;
}
.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}
.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}
.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}
.slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}
input:checked + .slider {
    background-color: #3498db;
}
input:checked + .slider:before {
    transform: translateX(26px);
}
.select {
    padding: 8px 12px;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    font-size: 14px;
    min-width: 150px;
}
.settings-btn {
    background: #6c757d;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 10px;
}
.settings-btn:hover {
    background: #5a6268;
}
.close-btn {
    background: #e74c3c;
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
}
@media (max-width: 768px) {
    .header h1 {
        font-size: 22px;
    }
    .panel {
        padding: 20px;
    }
    .controls {
        flex-direction: column;
    }
    .btn {
        width: 100%;
    }
    .statistics {
        grid-template-columns: repeat(2, 1fr);
    }
    .nav-menu {
        flex-wrap: wrap;
        padding: 0 20px;
    }
    .nav-btn {
        flex: 1;
        min-width: 120px;
        justify-content: center;
    }
}
@media (max-width: 480px) {
    body {
        padding: 10px;
    }
    .header {
        padding: 20px 15px;
    }
    .main-content {
        padding: 15px;
    }
    .statistics {
        grid-template-columns: 1fr;
    }
    .nav-btn {
        padding: 8px 12px;
        font-size: 12px;
    }
}
</style>
</head>
<body>
<div class="container">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="user-panel" id="userPanel">
            <div style="display: flex; align-items: center; gap: 10px;">
                <button class="btn" onclick="showSettings()" style="background: #6c757d; color: white; padding: 6px 12px; font-size: 12px;">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>
        </div>
        <h1>üéØ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–æ–≤</h1>
        <p>–ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π</p>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="nav-menu">
        <button class="nav-btn active" onclick="showPanel('monitoring')">üìπ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
        <button class="nav-btn" onclick="showPanel('violations')">üö® –ù–∞—Ä—É—à–µ–Ω–∏—è</button>
        <button class="nav-btn" onclick="showPanel('voice')">üé§ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã</button>
        <button class="nav-btn" onclick="showPanel('procedures')">üìã –ü—Ä–æ—Ü–µ–¥—É—Ä—ã</button>
        <button class="nav-btn" onclick="showPanel('reports')">üìù –û—Ç—á–µ—Ç—ã</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ü–∞–Ω–µ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
        <div class="left-column" id="monitoringPanel">
            <!-- –í–∏–¥–µ–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ -->
            <div class="panel">
                <h2>üìπ –í–∏–¥–µ–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h2>
                <div class="video-container">
                    <div class="video-placeholder" id="videoPlaceholder">
                        <div class="video-icon">üì∑</div>
                        <h3 style="margin-bottom: 10px;">–°–∏—Å—Ç–µ–º–∞ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è</h3>
                        <p>–î–ª—è –Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"</p>
                    </div>
                    <video class="video-feed" id="videoFeed" autoplay muted></video>
                </div>
                <div class="controls">
                    <button class="btn btn-success" onclick="startCamera()">
                        üì∑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É
                    </button>
                    <button class="btn btn-primary" onclick="startVideoAnalysis()">
                        üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn btn-danger" onclick="stopCamera()">
                        ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">–°–∏—Å—Ç–µ–º–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                </div>
                <div class="alert alert-info" id="systemAlert">
                    <div class="status-dot"></div>
                    <div>
                        <strong>–°—Ç–∞—Ç—É—Å:</strong> –û–∂–∏–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏<br>
                        <small>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π: <span id="violationCount">0</span></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ -->
        <div class="right-column" id="infoPanel">
            <!-- –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è -->
            <div class="panel" id="violationsPanel">
                <h2>üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è</h2>
                <div class="statistics">
                    <div class="stat-item">
                        <div class="stat-value" id="highCount">0</div>
                        <div class="stat-label">–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="mediumCount">0</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="lowCount">0</div>
                        <div class="stat-label">–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                    </div>
                </div>
                <div class="violation-list" id="violationList">
                    <!-- –ù–∞—Ä—É—à–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>

            <!-- –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã -->
            <div class="panel" id="voicePanel" style="display: none;">
                <h2>üé§ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã</h2>
                <div class="voice-control">
                    <div class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">
                        üé§
                    </div>
                    <div>
                        <strong id="voiceStatus">–ì–æ—Ç–æ–≤ –∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—é</strong><br>
                        <small>–ù–∞–∂–º–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã</small>
                    </div>
                </div>
                <div id="voiceResponse" class="alert alert-info" style="display: none;">
                    üîä <strong>–û—Ç–≤–µ—Ç —Å–∏—Å—Ç–µ–º—ã:</strong> <span id="responseText">...</span>
                </div>
                <div class="alert alert-warning">
                    üí° <strong>–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥:</strong><br>
                    "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã?"<br>
                    "–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –≥–æ–ª–æ—Å–æ–≤"<br>
                    "–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏?"
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–æ–≤—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã -->
            <div class="panel" id="proceduresPanel" style="display: none;">
                <h2>üìã –ü—Ä–∞–≤–æ–≤—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã</h2>
                <div class="procedure-list" id="procedureList">
                    <!-- –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ -->
            <div class="panel" id="reportsPanel" style="display: none;">
                <h2>üìù –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</h2>
                <div class="report-section">
                    <div class="form-group">
                        <label for="uikNumber">–ù–æ–º–µ—Ä –£–ò–ö:</label>
                        <input type="text" id="uikNumber" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£–ò–ö ‚Ññ1234">
                    </div>
                    <textarea id="incidentReport" placeholder="–û–ø–∏—à–∏—Ç–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç –ø–æ–¥—Ä–æ–±–Ω–æ..."></textarea>
                    <div class="controls" style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="generateReport()">
                            üìÑ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç
                        </button>
                        <button class="btn btn-warning" onclick="saveDraft()">
                            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
                        </button>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="exportAllData()" style="width: 100%;">
                        üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    <button class="btn btn-danger" onclick="clearAllData()" style="width: 100%; margin-top: 10px;">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <div class="footer">
        <p>¬© 2024 –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤</p>
        <button class="btn" onclick="goBackToMain()" style="margin-top: 10px; background: #6c757d; color: white;">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        </button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
<div class="login-modal" id="loginModal" style="display: none;">
    <div class="login-form">
        <h3>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
        <div class="form-group">
            <label for="username">–õ–æ–≥–∏–Ω:</label>
            <input type="text" id="username" placeholder="observer">
        </div>
        <div class="form-group">
            <label for="password">–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <div class="controls">
            <button class="btn btn-success" onclick="login()" style="width: 100%;">
                –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
            </button>
            <button class="btn btn-warning" onclick="demoMode()" style="width: 100%; margin-top: 10px;">
                –î–µ–º–æ-—Ä–µ–∂–∏–º
            </button>
        </div>
    </div>
</div>

<!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
<div class="settings-overlay" id="settingsOverlay" onclick="hideSettings()"></div>
<div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
        <h3>‚öôÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <button class="close-btn" onclick="hideSettings()">√ó</button>
    </div>
    
    <div class="settings-group">
        <h4>–í–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ</h4>
        <div class="setting-item">
            <span class="setting-label">–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã</span>
            <label class="switch">
                <input type="checkbox" id="autoCamera">
                <span class="slider"></span>
            </label>
        </div>
        <div class="setting-item">
            <span class="setting-label">–ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ</span>
            <select class="select" id="videoQuality">
                <option value="low">–ù–∏–∑–∫–æ–µ</option>
                <option value="medium" selected>–°—Ä–µ–¥–Ω–µ–µ</option>
                <option value="high">–í—ã—Å–æ–∫–æ–µ</option>
            </select>
        </div>
        <div class="setting-item">
            <span class="setting-label">–ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ</span>
            <label class="switch">
                <input type="checkbox" id="videoRecording">
                <span class="slider"></span>
            </label>
        </div>
    </div>
    
    <div class="settings-group">
        <h4>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞</h4>
        <div class="setting-item">
            <span class="setting-label">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</span>
            <label class="switch">
                <input type="checkbox" id="autoAnalysis" checked>
                <span class="slider"></span>
            </label>
        </div>
        <div class="setting-item">
            <span class="setting-label">–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
            <select class="select" id="detectionSensitivity">
                <option value="low">–ù–∏–∑–∫–∞—è</option>
                <option value="medium" selected>–°—Ä–µ–¥–Ω—è—è</option>
                <option value="high">–í—ã—Å–æ–∫–∞—è</option>
            </select>
        </div>
        <div class="setting-item">
            <span class="setting-label">–ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
            <label class="switch">
                <input type="checkbox" id="soundNotifications" checked>
                <span class="slider"></span>
            </label>
        </div>
    </div>
    
    <div class="settings-group">
        <h4>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h4>
        <div class="setting-item">
            <span class="setting-label">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</span>
            <label class="switch">
                <input type="checkbox" id="dataEncryption" checked>
                <span class="slider"></span>
            </label>
        </div>
        <div class="setting-item">
            <span class="setting-label">–ê–≤—Ç–æ–ª–æ–≥–∞—É—Ç (–º–∏–Ω—É—Ç)</span>
            <select class="select" id="autoLogout">
                <option value="15">15</option>
                <option value="30" selected>30</option>
                <option value="60">60</option>
                <option value="0">–ù–∏–∫–æ–≥–¥–∞</option>
            </select>
        </div>
        <div class="setting-item">
            <span class="setting-label">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
            <label class="switch">
                <input type="checkbox" id="autoBackup" checked>
                <span class="slider"></span>
            </label>
        </div>
    </div>
    
    <div class="settings-group">
        <h4>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h4>
        <div class="setting-item">
            <span class="setting-label">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
            <label class="switch">
                <input type="checkbox" id="darkTheme">
                <span class="slider"></span>
            </label>
        </div>
        <div class="setting-item">
            <span class="setting-label">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</span>
            <select class="select" id="fontSize">
                <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="large">–ö—Ä—É–ø–Ω—ã–π</option>
            </select>
        </div>
        <div class="setting-item">
            <span class="setting-label">–ê–Ω–∏–º–∞—Ü–∏–∏</span>
            <label class="switch">
                <input type="checkbox" id="animations" checked>
                <span class="slider"></span>
            </label>
        </div>
    </div>
    
    <div class="controls" style="margin-top: 30px;">
        <button class="btn btn-success" onclick="saveSettings()" style="flex: 2;">
            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
        <button class="btn btn-warning" onclick="resetSettings()" style="flex: 1;">
            üîÑ –°–±—Ä–æ—Å–∏—Ç—å
        </button>
    </div>
</div>

<script>
// === –ë–ê–ó–ê –î–ê–ù–ù–´–• ===
const legalDatabase = {
    violations: {
        'multiple_voting': {
            description: '–ü–æ–ø—ã—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞',
            action: '–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–æ–æ–±—â–∏—Ç—å –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—é –£–ò–ö –∏ –ø—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ—Ä–≥–∞–Ω–∞–º',
            reference: '–°—Ç–∞—Ç—å—è 142 –£–ö –†–§',
            priority: 'high'
        },
        'ballot_stuffing': {
            description: '–í–±—Ä–æ—Å –±—é–ª–ª–µ—Ç–µ–Ω–µ–π –≤ —É—Ä–Ω—É',
            action: '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤–∏–¥–µ–æ, —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∞–∫—Ç, —Å–æ–æ–±—â–∏—Ç—å –≤ –≤—ã—à–µ—Å—Ç–æ—è—â—É—é –∫–æ–º–∏—Å—Å–∏—é',
            reference: '–°—Ç–∞—Ç—å—è 141 –£–ö –†–§',
            priority: 'high'
        },
        'voter_intimidation': {
            description: '–î–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∏–∑–±–∏—Ä–∞—Ç–µ–ª–µ–π',
            action: '–ü—Ä–µ—Å–µ—á—å –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã–∑–≤–∞—Ç—å –ø–æ–ª–∏—Ü–∏—é, —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª',
            reference: '–°—Ç–∞—Ç—å—è 141 –£–ö –†–§',
            priority: 'high'
        },
        'photo_violation': {
            description: '–§–æ—Ç–æ—Å—ä–µ–º–∫–∞ –≤ –∫–∞–±–∏–Ω–µ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è',
            action: '–ü–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å —Å—ä–µ–º–∫—É, —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–º–µ—á–∞–Ω–∏–µ',
            reference: '–§–ó-67, —Å—Ç–∞—Ç—å—è 7',
            priority: 'medium'
        },
        'late_voting': {
            description: '–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ 20:00',
            action: '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω–æ–º–æ—á–∏—è',
            reference: '–§–ó-67, —Å—Ç–∞—Ç—å—è 71',
            priority: 'medium'
        },
        'improper_document': {
            description: '–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ/–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞',
            action: '–û—Ç–∫–∞–∑–∞—Ç—å –≤ –≤—ã–¥–∞—á–µ –±—é–ª–ª–µ—Ç–µ–Ω—è, —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∞–∫—Ç',
            reference: '–§–ó-67, —Å—Ç–∞—Ç—å—è 17',
            priority: 'low'
        }
    },
    procedures: [
        {
            id: 'voter_identification',
            title: 'üîç –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑–±–∏—Ä–∞—Ç–µ–ª—è',
            steps: ['–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Å–ø–æ—Ä—Ç –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞ –†–§', '–°–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–æ —Å–ø–∏—Å–∫–æ–º', '–£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥–ø–∏—Å–∏']
        },
        {
            id: 'ballot_issuance',
            title: 'üìÑ –í—ã–¥–∞—á–∞ –±—é–ª–ª–µ—Ç–µ–Ω–µ–π',
            steps: ['–£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–¥–∞—á–∏', '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–¥–ø–∏—Å–∏ —á–ª–µ–Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏', '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–¥–∞—á–∏']
        },
        {
            id: 'voting_process',
            title: 'üó≥Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è',
            steps: ['–ü—Ä–æ—Å–ª–µ–¥–∏—Ç—å –∑–∞ –æ–ø—É—Å–∫–∞–Ω–∏–µ–º –±—é–ª–ª–µ—Ç–µ–Ω—è', '–£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–æ—Ç–æ—Å—ä–µ–º–∫–∏', '–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–π–Ω—É –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è']
        },
        {
            id: 'counting_procedure',
            title: 'üìä –ü–æ–¥—Å—á–µ—Ç –≥–æ–ª–æ—Å–æ–≤',
            steps: ['–ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –≤—Å–∫—Ä—ã—Ç–∏–µ–º —É—Ä–Ω', '–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Å—á–µ—Ç –±—é–ª–ª–µ—Ç–µ–Ω–µ–π', '–ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤']
        }
    ]
};

// === –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´ ===
let systemState = {
    isActive: false,
    isCameraOn: false,
    isListening: false,
    violationCount: 0,
    highPriorityCount: 0,
    mediumPriorityCount: 0,
    lowPriorityCount: 0,
    reports: [],
    currentUser: null,
    settings: {
        autoCamera: false,
        videoQuality: 'medium',
        videoRecording: false,
        autoAnalysis: true,
        detectionSensitivity: 'medium',
        soundNotifications: true,
        dataEncryption: true,
        autoLogout: '30',
        autoBackup: true,
        darkTheme: false,
        fontSize: 'medium',
        animations: true
    }
};

let videoStream = null;

// === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    loadProcedures();
    loadSavedData();
    loadSettings();
    updateStatistics();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
    const userPanel = document.getElementById('userPanel');
    const exitBtn = document.createElement('button');
    exitBtn.className = 'btn';
    exitBtn.style.cssText = 'background: #e74c3c; color: white; padding: 6px 12px; font-size: 12px; margin-left: 10px;';
    exitBtn.innerHTML = 'üö™ –í—ã—Ö–æ–¥';
    exitBtn.onclick = logout;
    userPanel.appendChild(exitBtn);
});

// === –ù–ê–°–¢–†–û–ô–ö–ò ===
function showSettings() {
    document.getElementById('settingsPanel').style.display = 'block';
    document.getElementById('settingsOverlay').style.display = 'block';
    loadSettingsToForm();
}

function hideSettings() {
    document.getElementById('settingsPanel').style.display = 'none';
    document.getElementById('settingsOverlay').style.display = 'none';
}

function loadSettings() {
    const savedSettings = localStorage.getItem('election_advanced_settings');
    if (savedSettings) {
        systemState.settings = JSON.parse(savedSettings);
        applySettings();
    }
}

function loadSettingsToForm() {
    const settings = systemState.settings;
    document.getElementById('autoCamera').checked = settings.autoCamera;
    document.getElementById('videoQuality').value = settings.videoQuality;
    document.getElementById('videoRecording').checked = settings.videoRecording;
    document.getElementById('autoAnalysis').checked = settings.autoAnalysis;
    document.getElementById('detectionSensitivity').value = settings.detectionSensitivity;
    document.getElementById('soundNotifications').checked = settings.soundNotifications;
    document.getElementById('dataEncryption').checked = settings.dataEncryption;
    document.getElementById('autoLogout').value = settings.autoLogout;
    document.getElementById('autoBackup').checked = settings.autoBackup;
    document.getElementById('darkTheme').checked = settings.darkTheme;
    document.getElementById('fontSize').value = settings.fontSize;
    document.getElementById('animations').checked = settings.animations;
}

function saveSettings() {
    systemState.settings = {
        autoCamera: document.getElementById('autoCamera').checked,
        videoQuality: document.getElementById('videoQuality').value,
        videoRecording: document.getElementById('videoRecording').checked,
        autoAnalysis: document.getElementById('autoAnalysis').checked,
        detectionSensitivity: document.getElementById('detectionSensitivity').value,
        soundNotifications: document.getElementById('soundNotifications').checked,
        dataEncryption: document.getElementById('dataEncryption').checked,
        autoLogout: document.getElementById('autoLogout').value,
        autoBackup: document.getElementById('autoBackup').checked,
        darkTheme: document.getElementById('darkTheme').checked,
        fontSize: document.getElementById('fontSize').value,
        animations: document.getElementById('animations').checked
    };
    
    localStorage.setItem('election_advanced_settings', JSON.stringify(systemState.settings));
    applySettings();
    hideSettings();
    showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
}

function resetSettings() {
    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
        systemState.settings = {
            autoCamera: false,
            videoQuality: 'medium',
            videoRecording: false,
            autoAnalysis: true,
            detectionSensitivity: 'medium',
            soundNotifications: true,
            dataEncryption: true,
            autoLogout: '30',
            autoBackup: true,
            darkTheme: false,
            fontSize: 'medium',
            animations: true
        };
        
        loadSettingsToForm();
        showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
    }
}

function applySettings() {
    const settings = systemState.settings;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
    if (settings.darkTheme) {
        document.body.style.backgroundColor = '#1a1a2e';
        document.querySelector('.container').style.backgroundColor = '#16213e';
        document.querySelector('.container').style.color = '#fff';
    } else {
        document.body.style.backgroundColor = '';
        document.querySelector('.container').style.backgroundColor = '';
        document.querySelector('.container').style.color = '';
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
    const sizes = { small: '12px', medium: '14px', large: '16px' };
    document.body.style.fontSize = sizes[settings.fontSize];
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    if (!settings.animations) {
        document.querySelectorAll('*').forEach(el => {
            el.style.animation = 'none';
            el.style.transition = 'none';
        });
    }
    
    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
    if (settings.autoCamera && !systemState.isCameraOn) {
        setTimeout(startCamera, 1000);
    }
}

// === –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ===
function checkAuth() {
    const savedUser = localStorage.getItem('election_advanced_user');
    if (savedUser) {
        systemState.currentUser = JSON.parse(savedUser);
        showUserInfo();
    } else {
        document.getElementById('loginModal').style.display = 'flex';
    }
}

function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    const users = {
        'admin58': {name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', password: '893612', role: 'admin', avatar: 'üëë'},
        'observer': {name: '–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å', password: 'observer123', role: 'observer', avatar: 'üëÅÔ∏è'},
        'user': {name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', password: 'user123', role: 'user', avatar: 'üë§'}
    };
    
    if (users[username] && users[username].password === password) {
        systemState.currentUser = {
            username: username,
            name: users[username].name,
            role: users[username].role,
            avatar: users[username].avatar,
            loginTime: new Date().toISOString()
        };
        
        localStorage.setItem('election_advanced_user', JSON.stringify(systemState.currentUser));
        document.getElementById('loginModal').style.display = 'none';
        showUserInfo();
        showAlert(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${systemState.currentUser.name}!`, 'success');
    } else {
        showAlert('–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ demo: observer / observer123', 'warning');
    }
}

function logout() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        localStorage.removeItem('election_advanced_user');
        systemState.currentUser = null;
        document.getElementById('userPanel').innerHTML = '';
        document.getElementById('loginModal').style.display = 'flex';
        showAlert('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
    }
}

function demoMode() {
    systemState.currentUser = {
        username: 'demo',
        name: '–î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        role: 'observer',
        avatar: 'üëÅÔ∏è',
        loginTime: new Date().toISOString()
    };
    
    localStorage.setItem('election_advanced_user', JSON.stringify(systemState.currentUser));
    document.getElementById('loginModal').style.display = 'none';
    showUserInfo();
    showAlert('–í–∫–ª—é—á–µ–Ω –¥–µ–º–æ-—Ä–µ–∂–∏–º', 'info');
}

function showUserInfo() {
    if (systemState.currentUser) {
        document.getElementById('userPanel').innerHTML = `
            <div class="user-avatar">${systemState.currentUser.avatar}</div>
            <div>
                <strong>${systemState.currentUser.name}</strong><br>
                <small>${systemState.currentUser.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å'}</small>
            </div>
        `;
    }
}

// === –§–£–ù–ö–¶–ò–ò –í–ò–î–ï–û–ú–û–ù–ò–¢–û–†–ò–ù–ì–ê ===
async function startCamera() {
    try {
        const quality = systemState.settings.videoQuality;
        const constraints = {
            video: {
                width: { ideal: quality === 'high' ? 1920 : quality === 'medium' ? 1280 : 640 },
                height: { ideal: quality === 'high' ? 1080 : quality === 'medium' ? 720 : 480 },
                facingMode: 'environment'
            },
            audio: false
        };
        
        videoStream = await navigator.mediaDevices.getUserMedia(constraints);
        
        const videoFeed = document.getElementById('videoFeed');
        const placeholder = document.getElementById('videoPlaceholder');
        videoFeed.srcObject = videoStream;
        videoFeed.style.display = 'block';
        placeholder.style.display = 'none';
        
        systemState.isCameraOn = true;
        updateStatus('–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞', 'active');
        showAlert('–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –ú–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑.', 'success');
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
        if (systemState.settings.autoAnalysis) {
            setTimeout(startVideoAnalysis, 2000);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
        showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–º–æ-—Ä–µ–∂–∏–º.', 'warning');
        simulateCamera();
    }
}

function simulateCamera() {
    const placeholder = document.getElementById('videoPlaceholder');
    placeholder.innerHTML = `
        <div class="video-icon">üìπ</div>
        <h3>–î–µ–º–æ-—Ä–µ–∂–∏–º –∫–∞–º–µ—Ä—ã</h3>
        <p>–ò–º–∏—Ç–∞—Ü–∏—è –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞</p>
        <small style="margin-top: 10px; opacity: 0.7;">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º</small>
    `;
    systemState.isCameraOn = true;
    updateStatus('–î–µ–º–æ-—Ä–µ–∂–∏–º –∫–∞–º–µ—Ä—ã', 'active');
}

function stopCamera() {
    if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
        videoStream = null;
    }
    
    const videoFeed = document.getElementById('videoFeed');
    const placeholder = document.getElementById('videoPlaceholder');
    videoFeed.style.display = 'none';
    placeholder.style.display = 'flex';
    
    systemState.isCameraOn = false;
    systemState.isActive = false;
    updateStatus('–ö–∞–º–µ—Ä–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞', 'inactive');
    showAlert('–ö–∞–º–µ—Ä–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞', 'info');
}

function startVideoAnalysis() {
    if (!systemState.isCameraOn) {
        showAlert('–°–Ω–∞—á–∞–ª–∞ –≤–∫–ª—é—á–∏—Ç–µ –∫–∞–º–µ—Ä—É!', 'warning');
        return;
    }
    
    systemState.isActive = true;
    updateStatus('–ê–Ω–∞–ª–∏–∑ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏', 'active');
    showAlert('–ê–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ –∑–∞–ø—É—â–µ–Ω. –ù–∞—Ä—É—à–µ–Ω–∏—è –±—É–¥—É—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.', 'success');
    
    simulateViolationDetection();
}

function simulateViolationDetection() {
    if (!systemState.isActive) return;
    
    const sensitivity = systemState.settings.detectionSensitivity;
    const probability = sensitivity === 'high' ? 0.8 : sensitivity === 'medium' ? 0.6 : 0.4;
    
    if (Math.random() > (1 - probability)) {
        const violations = Object.keys(legalDatabase.violations);
        const randomViolation = violations[Math.floor(Math.random() * violations.length)];
        addViolation(randomViolation);
        
        // –ó–≤—É–∫–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        if (systemState.settings.soundNotifications) {
            playNotificationSound();
        }
    }
    
    if (systemState.isActive) {
        const interval = sensitivity === 'high' ? 2000 : sensitivity === 'medium' ? 4000 : 6000;
        setTimeout(simulateViolationDetection, interval + Math.random() * 2000);
    }
}

function playNotificationSound() {
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
    } catch (e) {
        console.log('–ó–≤—É–∫–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
    }
}

// === –û–ë–†–ê–ë–û–¢–ö–ê –ù–ê–†–£–®–ï–ù–ò–ô ===
function addViolation(violationType) {
    const violation = legalDatabase.violations[violationType];
    if (!violation) return;
    
    systemState.violationCount++;
    if (violation.priority === 'high') systemState.highPriorityCount++;
    if (violation.priority === 'medium') systemState.mediumPriorityCount++;
    if (violation.priority === 'low') systemState.lowPriorityCount++;
    
    updateStatistics();
    
    const violationList = document.getElementById('violationList');
    const violationItem = document.createElement('div');
    violationItem.className = `violation-item ${violation.priority}-priority`;
    violationItem.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
            <strong style="font-size: 14px;">${violation.description}</strong>
            <span style="font-size: 11px; background: ${violation.priority === 'high' ? '#e74c3c' : violation.priority === 'medium' ? '#f39c12' : '#3498db'}; color: white; padding: 2px 8px; border-radius: 10px;">
                ${violation.priority === 'high' ? '–í—ã—Å–æ–∫–∏–π' : violation.priority === 'medium' ? '–°—Ä–µ–¥–Ω–∏–π' : '–ù–∏–∑–∫–∏–π'}
            </span>
        </div>
        <p style="font-size: 13px; margin-bottom: 5px; color: #666;">üö® ${violation.action}</p>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
            <small style="font-size: 12px; color: #888;">üìö ${violation.reference}</small>
            <small style="font-size: 11px; color: #999;">${new Date().toLocaleTimeString()}</small>
        </div>
    `;
    
    violationItem.onclick = () => {
        showAlert(`–ù–∞—Ä—É—à–µ–Ω–∏–µ: ${violation.description}. –î–µ–π—Å—Ç–≤–∏–µ: ${violation.action}`, 'warning');
    };
    
    violationList.insertBefore(violationItem, violationList.firstChild);
    
    saveViolation({
        type: violationType,
        description: violation.description,
        timestamp: new Date().toISOString(),
        priority: violation.priority
    });
    
    showAlert(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–æ–≤–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: ${violation.description}`, 'warning');
}

// === –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===
function updateStatistics() {
    document.getElementById('violationCount').textContent = systemState.violationCount;
    document.getElementById('highCount').textContent = systemState.highPriorityCount;
    document.getElementById('mediumCount').textContent = systemState.mediumPriorityCount;
    document.getElementById('lowCount').textContent = systemState.lowPriorityCount;
}

function updateStatus(text, type) {
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    
    statusText.textContent = text;
    statusDot.className = 'status-dot';
    
    if (type === 'active') {
        statusDot.classList.add('active');
        document.getElementById('systemAlert').innerHTML = `
            <div class="status-dot active"></div>
            <div>
                <strong>–°—Ç–∞—Ç—É—Å:</strong> –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞<br>
                <small>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π: ${systemState.violationCount}</small>
            </div>
        `;
        document.getElementById('systemAlert').className = 'alert alert-success';
    } else {
        document.getElementById('systemAlert').innerHTML = `
            <div class="status-dot"></div>
            <div>
                <strong>–°—Ç–∞—Ç—É—Å:</strong> –°–∏—Å—Ç–µ–º–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞<br>
                <small>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π: ${systemState.violationCount}</small>
            </div>
        `;
        document.getElementById('systemAlert').className = 'alert alert-info';
    }
}

// === –ü–†–ê–í–û–í–´–ï –ü–†–û–¶–ï–î–£–†–´ ===
function loadProcedures() {
    const procedureList = document.getElementById('procedureList');
    procedureList.innerHTML = '';
    
    legalDatabase.procedures.forEach(procedure => {
        const item = document.createElement('div');
        item.className = 'procedure-item';
        item.innerHTML = `
            <div style="font-size: 20px;">${procedure.title.split(' ')[0]}</div>
            <div style="flex: 1;">
                <strong>${procedure.title.substring(2)}</strong>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    ${procedure.steps.length} —à–∞–≥–∞
                </div>
            </div>
        `;
        item.onclick = () => showProcedureDetails(procedure);
        procedureList.appendChild(item);
    });
}

function showProcedureDetails(procedure) {
    const stepsHtml = procedure.steps.map((step, index) =>
        `<li style="margin-bottom: 8px;">${index + 1}. ${step}</li>`
    ).join('');
    
    showAlert(`
        <strong>${procedure.title}</strong><br><br>
        <ol style="margin-left: 20px; margin-top: 10px;">
            ${stepsHtml}
        </ol>
    `, 'info');
}

// === –ì–û–õ–û–°–û–í–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï ===
function toggleVoiceRecognition() {
    const voiceBtn = document.getElementById('voiceBtn');
    const voiceStatus = document.getElementById('voiceStatus');
    
    if (!systemState.isListening) {
        systemState.isListening = true;
        voiceBtn.classList.add('listening');
        voiceStatus.textContent = '–°–ª—É—à–∞—é... –ì–æ–≤–æ—Ä–∏—Ç–µ —Å–µ–π—á–∞—Å';
        
        setTimeout(() => {
            processVoiceCommand();
        }, 2000);
    } else {
        systemState.isListening = false;
        voiceBtn.classList.remove('listening');
        voiceStatus.textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—é';
    }
}

function processVoiceCommand() {
    const commands = [
        '–∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑–±–∏—Ä–∞—Ç–µ–ª—è',
        '—á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –≤–±—Ä–æ—Å–µ –±—é–ª–ª–µ—Ç–µ–Ω–µ–π',
        '–ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –≥–æ–ª–æ—Å–æ–≤',
        '–∫–∞–∫ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∞–∫—Ç –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏',
        '–ø—Ä–∞–≤–∞ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –Ω–∞ —É—á–∞—Å—Ç–∫–µ',
        '–≤–∫–ª—é—á–∏ –∫–∞–º–µ—Ä—É',
        '–Ω–∞—á–Ω–∏ –∞–Ω–∞–ª–∏–∑',
        '–ø–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É'
    ];
    
    const randomCommand = commands[Math.floor(Math.random() * commands.length)];
    const response = getVoiceResponse(randomCommand);
    
    document.getElementById('responseText').textContent = response;
    document.getElementById('voiceResponse').style.display = 'flex';
    
    systemState.isListening = false;
    document.getElementById('voiceBtn').classList.remove('listening');
    document.getElementById('voiceStatus').textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—é';
    
    // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    executeVoiceCommand(randomCommand);
    
    // –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(response);
        utterance.lang = 'ru-RU';
        utterance.rate = 1.0;
        speechSynthesis.speak(utterance);
    }
}

function getVoiceResponse(command) {
    const responses = {
        '–∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑–±–∏—Ä–∞—Ç–µ–ª—è': '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã–º –≤ —Å–ø–∏—Å–∫–µ –∏–∑–±–∏—Ä–∞—Ç–µ–ª–µ–π. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥–ø–∏—Å–∏ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞.',
        '—á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –≤–±—Ä–æ—Å–µ –±—é–ª–ª–µ—Ç–µ–Ω–µ–π': '–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–æ–æ–±—â–∏—Ç–µ –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—é –£–ò–ö, –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –Ω–∞ –≤–∏–¥–µ–æ –∏ —Å–æ—Å—Ç–∞–≤—å—Ç–µ –∞–∫—Ç. –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã.',
        '–ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –≥–æ–ª–æ—Å–æ–≤': '–ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –≤—Å–∫—Ä—ã—Ç–∏–µ–º —É—Ä–Ω, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –ø–æ–¥—Å—á–µ—Ç –∫–∞–∂–¥–æ–≥–æ –±—é–ª–ª–µ—Ç–µ–Ω—è, –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.',
        '–∫–∞–∫ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∞–∫—Ç –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏': '–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è, –º–µ—Å—Ç–æ, —Å—É—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è, –¥–∞–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è –∏ —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π. –ü–æ–¥–ø–∏—à–∏—Ç–µ –∞–∫—Ç –∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∫–æ–ø–∏—é –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—é –£–ò–ö.',
        '–ø—Ä–∞–≤–∞ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –Ω–∞ —É—á–∞—Å—Ç–∫–µ': '–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ: –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞ —É—á–∞—Å—Ç–∫–µ, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è, –ø–æ–ª—É—á–∞—Ç—å –∫–æ–ø–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, –æ–±—Ä–∞—â–∞—Ç—å—Å—è –≤ –∫–æ–º–∏—Å—Å–∏–∏.',
        '–≤–∫–ª—é—á–∏ –∫–∞–º–µ—Ä—É': '–ó–∞–ø—É—Å–∫–∞—é –∫–∞–º–µ—Ä—É...',
        '–Ω–∞—á–Ω–∏ –∞–Ω–∞–ª–∏–∑': '–ù–∞—á–∏–Ω–∞—é –∞–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞...',
        '–ø–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É': `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –í—Å–µ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π - ${systemState.violationCount}, –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - ${systemState.highPriorityCount}`
    };
    
    for (const [key, value] of Object.entries(responses)) {
        if (command.toLowerCase().includes(key.split(' ')[0])) {
            return value;
        }
    }
    
    return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞.';
}

function executeVoiceCommand(command) {
    command = command.toLowerCase();
    
    if (command.includes('–≤–∫–ª—é—á–∏ –∫–∞–º–µ—Ä—É') || command.includes('–∑–∞–ø—É—Å—Ç–∏ –∫–∞–º–µ—Ä—É')) {
        startCamera();
    } else if (command.includes('–Ω–∞—á–Ω–∏ –∞–Ω–∞–ª–∏–∑') || command.includes('–∑–∞–ø—É—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑')) {
        startVideoAnalysis();
    } else if (command.includes('–æ—Å—Ç–∞–Ω–æ–≤–∏ –∫–∞–º–µ—Ä—É') || command.includes('–≤—ã–∫–ª—é—á–∏ –∫–∞–º–µ—Ä—É')) {
        stopCamera();
    } else if (command.includes('—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞') || command.includes('—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É')) {
        showAlert(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π: –í—Å–µ–≥–æ - ${systemState.violationCount}, –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - ${systemState.highPriorityCount}, –°—Ä–µ–¥–Ω–∏–π - ${systemState.mediumPriorityCount}, –ù–∏–∑–∫–∏–π - ${systemState.lowPriorityCount}`, 'info');
    }
}

// === –°–û–ó–î–ê–ù–ò–ï –û–¢–ß–ï–¢–û–í ===
function generateReport() {
    const uikNumber = document.getElementById('uikNumber').value;
    const incidentText = document.getElementById('incidentReport').value;
    
    if (!uikNumber || !incidentText.trim()) {
        showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –£–ò–ö –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞!', 'warning');
        return;
    }
    
    const report = {
        id: Date.now(),
        uikNumber: uikNumber,
        incident: incidentText,
        timestamp: new Date().toISOString(),
        violations: systemState.violationCount,
        highPriority: systemState.highPriorityCount,
        mediumPriority: systemState.mediumPriorityCount,
        lowPriority: systemState.lowPriorityCount,
        user: systemState.currentUser ? systemState.currentUser.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    };
    
    systemState.reports.push(report);
    saveReport(report);
    
    showAlert(`
        ‚úÖ –û—Ç—á–µ—Ç #${report.id} —É—Å–ø–µ—à–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω<br><br>
        <strong>–£–ò–ö:</strong> ${uikNumber}<br>
        <strong>–ù–∞—Ä—É—à–µ–Ω–∏–π –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ:</strong> ${systemState.violationCount}<br>
        <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${report.user}<br>
        <strong>–í—Ä–µ–º—è:</strong> ${new Date().toLocaleString()}<br><br>
        <small>–û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ</small>
    `, 'success');
    
    document.getElementById('incidentReport').value = '';
    downloadReport(report);
}

function saveDraft() {
    const uikNumber = document.getElementById('uikNumber').value;
    const incidentText = document.getElementById('incidentReport').value;
    
    if (incidentText.trim()) {
        const draft = {
            uikNumber: uikNumber || '–ù–µ —É–∫–∞–∑–∞–Ω',
            incident: incidentText,
            savedAt: new Date().toLocaleTimeString()
        };
        localStorage.setItem('election_draft', JSON.stringify(draft));
        showAlert('–ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω', 'info');
    } else {
        showAlert('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'warning');
    }
}

function downloadReport(report) {
    const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `–û—Ç—á–µ—Ç_–£–ò–ö_${report.uikNumber}_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// === –ù–ê–í–ò–ì–ê–¶–ò–Ø ===
function showPanel(panelName) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞
    const buttons = document.querySelectorAll('.nav-btn');
    buttons.forEach(btn => {
        if (btn.textContent.includes(getPanelIcon(panelName))) {
            btn.classList.add('active');
        }
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏
    const infoPanels = ['violationsPanel', 'voicePanel', 'proceduresPanel', 'reportsPanel'];
    infoPanels.forEach(panel => {
        document.getElementById(panel).style.display = 'none';
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å
    switch(panelName) {
        case 'monitoring':
            // –ü–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —É–∂–µ –≤–∏–¥–Ω–∞
            break;
        case 'violations':
            document.getElementById('violationsPanel').style.display = 'block';
            break;
        case 'voice':
            document.getElementById('voicePanel').style.display = 'block';
            break;
        case 'procedures':
            document.getElementById('proceduresPanel').style.display = 'block';
            break;
        case 'reports':
            document.getElementById('reportsPanel').style.display = 'block';
            break;
    }
}

function getPanelIcon(panelName) {
    const icons = {
        'monitoring': 'üìπ',
        'violations': 'üö®',
        'voice': 'üé§',
        'procedures': 'üìã',
        'reports': 'üìù'
    };
    return icons[panelName] || 'üìã';
}

// === –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• ===
function saveViolation(violation) {
    const savedViolations = JSON.parse(localStorage.getItem('election_violations') || '[]');
    savedViolations.push(violation);
    
    // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
    if (systemState.settings.dataEncryption) {
        violation.encrypted = true;
        violation.timestamp = btoa(violation.timestamp);
    }
    
    localStorage.setItem('election_violations', JSON.stringify(savedViolations));
}

function saveReport(report) {
    const savedReports = JSON.parse(localStorage.getItem('election_reports') || '[]');
    savedReports.push(report);
    
    // –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
    if (systemState.settings.autoBackup) {
        localStorage.setItem('election_backup_' + Date.now(), JSON.stringify(report));
    }
    
    localStorage.setItem('election_reports', JSON.stringify(savedReports));
}

function loadSavedData() {
    const savedViolations = JSON.parse(localStorage.getItem('election_violations') || '[]');
    savedViolations.forEach(violation => {
        // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
        if (violation.encrypted && violation.timestamp) {
            violation.timestamp = atob(violation.timestamp);
        }
        addViolation(violation.type);
    });
    
    const draft = JSON.parse(localStorage.getItem('election_draft') || 'null');
    if (draft) {
        document.getElementById('uikNumber').value = draft.uikNumber;
        document.getElementById('incidentReport').value = draft.incident;
    }
    
    updateStatistics();
}

function exportAllData() {
    const data = {
        user: systemState.currentUser,
        violations: JSON.parse(localStorage.getItem('election_violations') || '[]'),
        reports: JSON.parse(localStorage.getItem('election_reports') || '[]'),
        statistics: {
            totalViolations: systemState.violationCount,
            highPriority: systemState.highPriorityCount,
            mediumPriority: systemState.mediumPriorityCount,
            lowPriority: systemState.lowPriorityCount
        },
        settings: systemState.settings,
        exportedAt: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `–î–∞–Ω–Ω—ã–µ_–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showAlert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON —Ñ–∞–π–ª', 'success');
}

function clearAllData() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö –∏ –æ—Ç—á–µ—Ç–∞—Ö –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
        localStorage.removeItem('election_violations');
        localStorage.removeItem('election_reports');
        localStorage.removeItem('election_draft');
        
        systemState.violationCount = 0;
        systemState.highPriorityCount = 0;
        systemState.mediumPriorityCount = 0;
        systemState.lowPriorityCount = 0;
        
        updateStatistics();
        document.getElementById('violationList').innerHTML = '';
        
        showAlert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'info');
    }
}

// === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
function showAlert(message, type = 'info') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.innerHTML = message;
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
    `;
    
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        alertDiv.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => {
            document.body.removeChild(alertDiv);
        }, 300);
    }, 5000);
}

function goBackToMain() {
    if (confirm('–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é? –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.')) {
        window.location.href = 'index.html';
    }
}

// === –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò ===
document.addEventListener('keydown', function(e) {
    // Ctrl+S - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
    if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        saveDraft();
    }
    
    // Ctrl+E - —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
    if (e.ctrlKey && e.key === 'e') {
        e.preventDefault();
        exportAllData();
    }
    
    // Ctrl+Shift+S - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    if (e.ctrlKey && e.shiftKey && e.key === 'S') {
        e.preventDefault();
        showSettings();
    }
    
    // Space - –≥–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    if (e.code === 'Space' && e.target.tagName !== 'TEXTAREA' && e.target.tagName !== 'INPUT') {
        e.preventDefault();
        toggleVoiceRecognition();
    }
    
    // F1 - –ø–æ–º–æ—â—å
    if (e.key === 'F1') {
        e.preventDefault();
        showAlert(`
            <strong>–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:</strong><br>
            ‚Ä¢ Ctrl+S - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫<br>
            ‚Ä¢ Ctrl+E - –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö<br>
            ‚Ä¢ Ctrl+Shift+S - –ù–∞—Å—Ç—Ä–æ–π–∫–∏<br>
            ‚Ä¢ –ü—Ä–æ–±–µ–ª - –ì–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ<br>
            ‚Ä¢ F1 - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞<br><br>
            <strong>–ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:</strong><br>
            ‚Ä¢ "–í–∫–ª—é—á–∏ –∫–∞–º–µ—Ä—É"<br>
            ‚Ä¢ "–ù–∞—á–Ω–∏ –∞–Ω–∞–ª–∏–∑"<br>
            ‚Ä¢ "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"<br>
            ‚Ä¢ "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã?"
        `, 'info');
    }
});

// === –ê–í–¢–û–õ–û–ì–ê–£–¢ ===
let logoutTimer;
function resetLogoutTimer() {
    if (systemState.settings.autoLogout !== '0') {
        clearTimeout(logoutTimer);
        const minutes = parseInt(systemState.settings.autoLogout);
        logoutTimer = setTimeout(() => {
            if (confirm(`–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É?`)) {
                resetLogoutTimer();
            } else {
                logout();
            }
        }, (minutes - 1) * 60000);
    }
}

document.addEventListener('mousemove', resetLogoutTimer);
document.addEventListener('keypress', resetLogoutTimer);

// === –ó–ê–ö–†–´–¢–ò–ï –°–ï–°–°–ò–ò ===
window.addEventListener('beforeunload', function(e) {
    if (systemState.violationCount > 0 || systemState.reports.length > 0) {
        const message = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–π—Ç–∏?';
        e.returnValue = message;
        return message;
    }
});

// === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê ===
console.log('–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
resetLogoutTimer();
</script>
</body>
</html>
